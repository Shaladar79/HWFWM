<header class="hwfwm-sheet__header">

  <div class="hwfwm-header-layout">

    <!-- LEFT: Portrait + Type -->
    <div class="hwfwm-header-portrait">
      <img class="hwfwm-header-portrait__img" src="{{document.img}}" data-edit="img" alt="{{document.name}}" />
      <div class="hwfwm-header-portrait__type">
        {{document.type}}
      </div>
    </div>

    <!-- RIGHT: Name + Inline fields -->
    <div class="hwfwm-header-main">

      <input
        class="hwfwm-sheet__name"
        name="name"
        type="text"
        value="{{document.name}}"
        placeholder="Name"
      />

      <div class="hwfwm-header-inline">

        <!-- Rank (derived, read-only, compact) -->
        <div class="hwfwm-header-field hwfwm-header-field--rank">
          <label class="hwfwm-header-label hwfwm-header-label--small">Rank</label>
          <input
            class="hwfwm-header-select"
            type="text"
            value="{{derivedRankLabel}}"
            readonly
          />
        </div>

        <!-- Race (read-only display; editable in Overview) -->
        <div class="hwfwm-header-field">
          <label class="hwfwm-header-label hwfwm-header-label--small">Race</label>
          <input
            class="hwfwm-header-select"
            type="text"
            value="{{selectedRaceLabel}}"
            readonly
          />
        </div>

        <!-- Role (read-only display; editable in Overview) -->
        <div class="hwfwm-header-field">
          <label class="hwfwm-header-label hwfwm-header-label--small">Role</label>
          <input
            class="hwfwm-header-select"
            type="text"
            value="{{selectedRoleLabel}}"
            readonly
          />
        </div>

        <!-- Background (read-only display; editable in Overview) -->
        <div class="hwfwm-header-field">
          <label class="hwfwm-header-label hwfwm-header-label--small">Background</label>
          <input
            class="hwfwm-header-select"
            type="text"
            value="{{selectedBackgroundLabel}}"
            readonly
          />
        </div>

        {{!-- Character creation lock (disappears once used) --}}
        {{#unless system._flags.choicesLocked}}
        <div class="hwfwm-header-field hwfwm-header-field--lock">
          <button
            type="button"
            class="hwfwm-itembtn"
            data-action="lock-choices"
            title="Lock Race, Role, and Background to prevent further changes"
            style="align-self: end;"
          >
            Lock Choices
          </button>
        </div>
        {{/unless}}

      </div>

      <!-- Bottom line: Attribute Saves (labels aligned above compact totals) -->
      <div
        class="hwfwm-header-saves"
        style="display: grid; grid-template-columns: repeat(4, max-content); gap: 10px; margin-top: 8px;"
      >

        <div class="hwfwm-header-save" style="display: flex; flex-direction: column; align-items: center;">
          <button
            type="button"
            class="hwfwm-header-save__label"
            data-action="roll-attribute"
            data-attr="power"
            style="padding: 0; line-height: 1.1;"
          >
            Power Save
          </button>
          <input
            class="hwfwm-header-save__value"
            type="text"
            value="{{system.attributes.power.total}}"
            readonly
            data-key="powerSave"
            data-path="system.attributes.power.total"
            style="width: 56px; height: 24px; padding: 2px 4px; text-align: center;"
          />
        </div>

        <div class="hwfwm-header-save" style="display: flex; flex-direction: column; align-items: center;">
          <button
            type="button"
            class="hwfwm-header-save__label"
            data-action="roll-attribute"
            data-attr="speed"
            style="padding: 0; line-height: 1.1;"
          >
            Speed Save
          </button>
          <input
            class="hwfwm-header-save__value"
            type="text"
            value="{{system.attributes.speed.total}}"
            readonly
            data-key="speedSave"
            data-path="system.attributes.speed.total"
            style="width: 56px; height: 24px; padding: 2px 4px; text-align: center;"
          />
        </div>

        <div class="hwfwm-header-save" style="display: flex; flex-direction: column; align-items: center;">
          <button
            type="button"
            class="hwfwm-header-save__label"
            data-action="roll-attribute"
            data-attr="spirit"
            style="padding: 0; line-height: 1.1;"
          >
            Spirit Save
          </button>
          <input
            class="hwfwm-header-save__value"
            type="text"
            value="{{system.attributes.spirit.total}}"
            readonly
            data-key="spiritSave"
            data-path="system.attributes.spirit.total"
            style="width: 56px; height: 24px; padding: 2px 4px; text-align: center;"
          />
        </div>

        <div class="hwfwm-header-save" style="display: flex; flex-direction: column; align-items: center;">
          <button
            type="button"
            class="hwfwm-header-save__label"
            data-action="roll-attribute"
            data-attr="recovery"
            style="padding: 0; line-height: 1.1;"
          >
            Recovery Save
          </button>
          <input
            class="hwfwm-header-save__value"
            type="text"
            value="{{system.attributes.recovery.total}}"
            readonly
            data-key="recoverySave"
            data-path="system.attributes.recovery.total"
            style="width: 56px; height: 24px; padding: 2px 4px; text-align: center;"
          />
        </div>

      </div>

    </div>

  </div>
</header>
