<div class="hwfwm-card">

  <div class="hwfwm-card__title">Specialties</div>

  <!-- Add Specialty Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addSpecialtyKey">
      <option value="">— Add Specialty —</option>
      {{!-- iterate the injected top-level catalog (from _prepareContext) --}}
      {{#each specialtyCatalog as |s key|}}
        <option value="{{key}}">{{s.name}}</option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-specialty">
      Add
    </button>
  </div>

  <!-- Specialties Table -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Specialty</div>
      <div>Attribute</div>
      <div>Total</div>
      <div>Description</div>
      <div></div>
    </div>

    {{!-- Base list (fixed) --}}
    {{#each system.specialties as |spec key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">{{spec.name}}</div>

      <input type="text"
             name="system.specialties.{{key}}.attribute"
             value="{{spec.attribute}}"
             placeholder="Attribute" />

      <input type="number"
             name="system.specialties.{{key}}.total"
             value="{{spec.total}}"
             placeholder="0" />

      <input type="text"
             name="system.specialties.{{key}}.notes"
             value="{{spec.notes}}"
             placeholder="Description" />

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-roll"
                data-roll="specialty"
                data-key="{{key}}"
                {{#unless spec.total}}disabled{{/unless}}>
          Roll
        </button>
      </div>
    </div>
    {{/each}}

    {{!-- Custom-added list (removable) --}}
    {{#each system.specialtiesCustom as |spec key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">{{spec.name}}</div>

      <input type="text"
             name="system.specialtiesCustom.{{key}}.attribute"
             value="{{spec.attribute}}"
             placeholder="Attribute" />

      <input type="number"
             name="system.specialtiesCustom.{{key}}.total"
             value="{{spec.total}}"
             placeholder="0" />

      <input type="text"
             name="system.specialtiesCustom.{{key}}.notes"
             value="{{spec.notes}}"
             placeholder="Description" />

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-roll"
                data-roll="specialty-custom"
                data-key="{{key}}"
                {{#unless spec.total}}disabled{{/unless}}>
          Roll
        </button>

        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-specialty"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>

<div class="hwfwm-card">
  <div class="hwfwm-card__title">Affinities</div>

  <!-- Add Affinity Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addAffinityKey">
      <option value="">— Add Affinity —</option>
      {{!-- iterate the injected top-level affinity catalog (from _prepareContext) --}}
      {{#each affinityCatalog as |a key|}}
        <option value="{{key}}">Affinity: {{a.name}}</option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-affinity">
      Add
    </button>
  </div>

  <!-- Selected Affinities List -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Affinity</div>
      <div></div>
    </div>

    {{#each system.affinities as |a key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">Affinity: {{a.name}}</div>

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-affinity"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>

<div class="hwfwm-card">
  <div class="hwfwm-card__title">Aptitudes</div>

  <!-- Add Aptitude Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addAptitudeKey">
      <option value="">— Add Aptitude —</option>
      {{!-- iterate the injected top-level aptitude catalog (from _prepareContext) --}}
      {{#each aptitudeCatalog as |a key|}}
        <option value="{{key}}">Aptitude: {{a.name}}</option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-aptitude">
      Add
    </button>
  </div>

  <!-- Selected Aptitudes List -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Aptitude</div>
      <div></div>
    </div>

    {{#each system.aptitudes as |a key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">Aptitude: {{a.name}}</div>

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-aptitude"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>

<div class="hwfwm-card">
  <div class="hwfwm-card__title">Resistances</div>

  <!-- Add Resistance Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addResistanceKey">
      <option value="">— Add Resistance —</option>
      {{!-- iterate the injected top-level resistance catalog (from _prepareContext) --}}
      {{#each resistanceCatalog as |r key|}}
        <option value="{{key}}">Resistance: {{r.name}}</option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-resistance">
      Add
    </button>
  </div>

  <!-- Selected Resistances List -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Resistance</div>
      <div></div>
    </div>

    {{#each system.resistances as |r key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">Resistance: {{r.name}}</div>

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-resistance"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>
