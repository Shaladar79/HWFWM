<div class="hwfwm-card">

  <div class="hwfwm-card__title">Specialties</div>

  <!-- Add Specialty Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addSpecialtyKey">
      <option value="">— Add Specialty —</option>
      {{#each specialtyCatalog as |s key|}}
        <option value="{{key}}" {{#if (eq key ../system._ui.addSpecialtyKey)}}selected{{/if}}>
          {{s.name}}
        </option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-specialty">
      Add
    </button>
  </div>

  <!-- Specialties Table -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Specialty</div>
      <div>Attribute</div>
      <div>Score</div>
      <div>Description</div>
      <div></div>
    </div>

    {{!-- Effective specialties (manual + granted) --}}
    {{#each effectiveSpecialties as |spec|}}
      <div class="hwfwm-spec-row">
        <div class="hwfwm-spec-name">
          {{spec.name}}
          {{#if spec.isGranted}}
            <span class="hwfwm-muted" style="margin-left: 6px;">(Granted)</span>
          {{/if}}
        </div>

        <div class="hwfwm-spec-attr">{{spec.attribute}}</div>

        <input type="number"
               name="system.specialties.{{spec.key}}.score"
               value="{{spec.score}}"
               min="0"
               step="1"
               placeholder="0"
               {{#if spec.isGranted}}readonly{{/if}} />

        <div class="hwfwm-spec-desc">{{spec.description}}</div>

        <div class="hwfwm-spec-actions">
          <button type="button"
                  class="hwfwm-roll"
                  data-roll="specialty"
                  data-key="{{spec.key}}"
                  disabled>
            Roll
          </button>
        </div>
      </div>
    {{/each}}

  </div>
</div>

<div class="hwfwm-card">
  <div class="hwfwm-card__title">Affinities</div>

  <!-- Add Affinity Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addAffinityKey">
      <option value="">— Add Affinity —</option>
      {{#each affinityCatalog as |a key|}}
        <option value="{{key}}" {{#if (eq key ../system._ui.addAffinityKey)}}selected{{/if}}>
          Affinity: {{a.name}}
        </option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-affinity">
      Add
    </button>
  </div>

  <!-- Selected Affinities List -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Affinity</div>
      <div></div>
    </div>

    {{#each system.affinities as |a key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">Affinity: {{a.name}}</div>

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-affinity"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>

<div class="hwfwm-card">
  <div class="hwfwm-card__title">Aptitudes</div>

  <!-- Add Aptitude Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addAptitudeKey">
      <option value="">— Add Aptitude —</option>
      {{#each aptitudeCatalog as |a key|}}
        <option value="{{key}}" {{#if (eq key ../system._ui.addAptitudeKey)}}selected{{/if}}>
          Aptitude: {{a.name}}
        </option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-aptitude">
      Add
    </button>
  </div>

  <!-- Selected Aptitudes List -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Aptitude</div>
      <div></div>
    </div>

    {{#each system.aptitudes as |a key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">Aptitude: {{a.name}}</div>

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-aptitude"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>

<div class="hwfwm-card">
  <div class="hwfwm-card__title">Resistances</div>

  <!-- Add Resistance Controls -->
  <div class="hwfwm-spec-add">
    <select name="system._ui.addResistanceKey">
      <option value="">— Add Resistance —</option>
      {{#each resistanceCatalog as |r key|}}
        <option value="{{key}}" {{#if (eq key ../system._ui.addResistanceKey)}}selected{{/if}}>
          Resistance: {{r.name}}
        </option>
      {{/each}}
    </select>

    <button type="button" class="hwfwm-itembtn" data-action="add-resistance">
      Add
    </button>
  </div>

  <!-- Selected Resistances List -->
  <div class="hwfwm-spec-table">

    <div class="hwfwm-spec-head">
      <div>Resistance</div>
      <div></div>
    </div>

    {{#each system.resistances as |r key|}}
    <div class="hwfwm-spec-row">
      <div class="hwfwm-spec-name">Resistance: {{r.name}}</div>

      <div class="hwfwm-spec-actions">
        <button type="button"
                class="hwfwm-itembtn hwfwm-itembtn--danger"
                data-action="remove-resistance"
                data-key="{{key}}">
          Remove
        </button>
      </div>
    </div>
    {{/each}}

  </div>
</div>
