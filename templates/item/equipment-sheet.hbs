<div class="hwfwm-item-sheet hwfwm-item-sheet--equipment" autocomplete="off">
  <header class="hwfwm-item-header">
    <div class="hwfwm-item-title">
      <label class="hwfwm-label" style="color:#000;">Name</label>
      <input type="text" name="name" value="{{item.name}}" placeholder="Equipment Name" />
    </div>
  </header>

  <section class="hwfwm-item-body" style="color:#000;">

    <!-- CORE -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Equipment</div>

      <div class="hwfwm-grid">
        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Type</div>
          <select name="system.type">
            <option value="">— Select —</option>
            {{#each equipmentTypes as |t|}}
              <option value="{{t.value}}" {{#if (eq t.value ../system.type)}}selected{{/if}}>
                {{t.label}}
              </option>
            {{/each}}
          </select>
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Equipped</div>
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" name="system.equipped" {{#if system.equipped}}checked{{/if}} />
            <span style="color:#000;">Apply when equipped</span>
          </label>
        </div>
      </div>
    </div>

    <!-- IMAGE (top) -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Image</div>
      <div class="hwfwm-muted" style="margin-bottom: 8px; color:#000;">
        Click the image to change it.
      </div>

      <img
        src="{{item.img}}"
        data-edit="img"
        title="{{item.name}}"
        style="max-width: 180px; height: auto; cursor: pointer; border: 1px solid rgba(0,0,0,0.35); border-radius: 6px;"
      />
    </div>

    <!-- DESCRIPTION (below image, shared) -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Description</div>
      <textarea name="system.description" rows="6">{{system.description}}</textarea>
    </div>

    <!-- ITEM RANK (persistent, directly under Description) -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Item Rank</div>
      <div class="hwfwm-grid">
        <div class="hwfwm-field" style="grid-column: 1 / -1;">
          <div class="hwfwm-label" style="color:#000;">Rank</div>
          <select name="system.itemRank">
            <option value="normal" {{#if (eq system.itemRank "normal")}}selected{{/if}}>Normal</option>
            <option value="iron" {{#if (eq system.itemRank "iron")}}selected{{/if}}>Iron</option>
            <option value="bronze" {{#if (eq system.itemRank "bronze")}}selected{{/if}}>Bronze</option>
            <option value="silver" {{#if (eq system.itemRank "silver")}}selected{{/if}}>Silver</option>
            <option value="gold" {{#if (eq system.itemRank "gold")}}selected{{/if}}>Gold</option>
            <option value="diamond" {{#if (eq system.itemRank "diamond")}}selected{{/if}}>Diamond</option>
          </select>
        </div>
      </div>
    </div>

    <!-- WEAPON -->
    {{#if _ui.isWeapon}}
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Weapon</div>

      <div class="hwfwm-grid">
        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Weapon Category</div>
          <select name="system.weapon.category">
            <option value="">— Select —</option>
            {{#each weaponCategoryOptions as |o|}}
              <option value="{{o.value}}" {{#if (eq o.value ../system.weapon.category)}}selected{{/if}}>
                {{o.label}}
              </option>
            {{/each}}
          </select>
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Weapon Type</div>
          <select name="system.weapon.weaponType" {{#unless system.weapon.category}}disabled{{/unless}}>
            <option value="">— Select —</option>
            {{#each weaponTypeOptions as |o|}}
              <option value="{{o.value}}" {{#if (eq o.value ../system.weapon.weaponType)}}selected{{/if}}>
                {{o.label}}
              </option>
            {{/each}}
          </select>
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Damage per Success</div>
          <input type="number" name="system.weapon.damagePerSuccess" value="{{system.weapon.damagePerSuccess}}" step="1" placeholder="0" />
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Range</div>
          <input type="number" name="system.weapon.range" value="{{system.weapon.range}}" step="1" placeholder="0" />
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Action Cost</div>
          <input type="number" name="system.weapon.actionCost" value="{{system.weapon.actionCost}}" step="1" placeholder="0" />
        </div>

        <div class="hwfwm-field" style="grid-column: 1 / -1;">
          <div class="hwfwm-label" style="color:#000;">Damage Types</div>
          <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <div>
              <div class="hwfwm-label" style="color:#000;">Damage Type 1</div>
              <select name="system.weapon.damageType1">
                <option value="">— Select —</option>
                {{#each damageTypeOptions as |o|}}
                  <option value="{{o.value}}" {{#if (eq o.value ../system.weapon.damageType1)}}selected{{/if}}>
                    {{o.label}}
                  </option>
                {{/each}}
              </select>
            </div>

            <div>
              <div class="hwfwm-label" style="color:#000;">Damage Type 2</div>
              <select name="system.weapon.damageType2">
                <option value="">— Select —</option>
                {{#each damageTypeOptions as |o|}}
                  <option value="{{o.value}}" {{#if (eq o.value ../system.weapon.damageType2)}}selected{{/if}}>
                    {{o.label}}
                  </option>
                {{/each}}
              </select>
            </div>

            <div>
              <div class="hwfwm-label" style="color:#000;">Damage Type 3</div>
              <select name="system.weapon.damageType3">
                <option value="">— Select —</option>
                {{#each damageTypeOptions as |o|}}
                  <option value="{{o.value}}" {{#if (eq o.value ../system.weapon.damageType3)}}selected{{/if}}>
                    {{o.label}}
                  </option>
                {{/each}}
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
    {{/if}}

    <!-- ARMOR -->
    {{#if _ui.isArmor}}
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Armor</div>

      <div class="hwfwm-grid">
        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Armor Class</div>
          <select name="system.armor.armorType">
            <option value="">— Select —</option>
            {{#each armorClassOptions as |o|}}
              <option value="{{o.value}}" {{#if (eq o.value ../system.armor.armorType)}}selected{{/if}}>
                {{o.label}}
              </option>
            {{/each}}
          </select>
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Armor Type</div>
          <select name="system.armor.armorName" {{#unless system.armor.armorType}}disabled{{/unless}}>
            <option value="">— Select —</option>
            {{#each armorTypeOptions as |o|}}
              <option value="{{o.value}}" {{#if (eq o.value ../system.armor.armorName)}}selected{{/if}}>
                {{o.label}}
              </option>
            {{/each}}
          </select>
        </div>

        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Armor</div>
          <input type="number" name="system.armor.value" value="{{system.armor.value}}" step="1" placeholder="0" />
        </div>
      </div>
    </div>
    {{/if}}

    <!-- MISC -->
    {{#if _ui.isMisc}}
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Misc</div>

      <div class="hwfwm-grid">
        <div class="hwfwm-field">
          <div class="hwfwm-label" style="color:#000;">Armor (Misc)</div>
          <input type="number" name="system.misc.armor" value="{{system.misc.armor}}" step="1" placeholder="0" />
        </div>
      </div>
    </div>
    {{/if}}

    <!-- ADJUSTMENTS -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Adjustments</div>

      <!-- Attributes -->
      <div class="hwfwm-card__title" style="font-size: 0.95em; margin-top: 6px; color:#000;">Attributes</div>
      <div style="display:grid; grid-template-columns: 1.2fr 1fr; gap: 8px; align-items:center;">
        <div style="color:#000;"><strong>Attribute</strong></div>
        <div style="color:#000;"><strong>Flat Delta</strong></div>

        {{#each attributesList as |a|}}
          <div style="color:#000;">{{a.label}}</div>
          <input
            type="number"
            name="system.adjustments.attributes.{{a.value}}.flat"
            value="{{lookup (lookup ../system.adjustments.attributes a.value) 'flat'}}"
            step="1"
            placeholder="0"
          />
        {{/each}}
      </div>

      <!-- Resources -->
      <div class="hwfwm-card__title" style="font-size: 0.95em; margin-top: 14px; color:#000;">Resources</div>
      <div class="hwfwm-muted" style="margin-bottom: 8px; color:#000;">
        Life Force / Mana / Stamina support % + Flat. All others are Flat only.
      </div>

      <div style="display:grid; grid-template-columns: 1.4fr 1fr 1fr; gap: 8px; align-items:center;">
        <div style="color:#000;"><strong>Resource</strong></div>
        <div style="color:#000;"><strong>% Delta</strong></div>
        <div style="color:#000;"><strong>Flat Delta</strong></div>

        <div style="color:#000;">Life Force (Max)</div>
        <input type="number" name="system.adjustments.resources.lifeForce.pct" value="{{lookup (lookup system.adjustments.resources 'lifeForce') 'pct'}}" step="1" placeholder="0" />
        <input type="number" name="system.adjustments.resources.lifeForce.flat" value="{{lookup (lookup system.adjustments.resources 'lifeForce') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Mana (Max)</div>
        <input type="number" name="system.adjustments.resources.mana.pct" value="{{lookup (lookup system.adjustments.resources 'mana') 'pct'}}" step="1" placeholder="0" />
        <input type="number" name="system.adjustments.resources.mana.flat" value="{{lookup (lookup system.adjustments.resources 'mana') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Stamina (Max)</div>
        <input type="number" name="system.adjustments.resources.stamina.pct" value="{{lookup (lookup system.adjustments.resources 'stamina') 'pct'}}" step="1" placeholder="0" />
        <input type="number" name="system.adjustments.resources.stamina.flat" value="{{lookup (lookup system.adjustments.resources 'stamina') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Trauma</div>
        <div></div>
        <input type="number" name="system.adjustments.resources.trauma.flat" value="{{lookup (lookup system.adjustments.resources 'trauma') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Pace</div>
        <div></div>
        <input type="number" name="system.adjustments.resources.pace.flat" value="{{lookup (lookup system.adjustments.resources 'pace') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Reaction</div>
        <div></div>
        <input type="number" name="system.adjustments.resources.reaction.flat" value="{{lookup (lookup system.adjustments.resources 'reaction') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Defense</div>
        <div></div>
        <input type="number" name="system.adjustments.resources.defense.flat" value="{{lookup (lookup system.adjustments.resources 'defense') 'flat'}}" step="1" placeholder="0" />

        <div style="color:#000;">Natural Armor</div>
        <div></div>
        <input type="number" name="system.adjustments.resources.naturalArmor.flat" value="{{lookup (lookup system.adjustments.resources 'naturalArmor') 'flat'}}" step="1" placeholder="0" />
      </div>

      <!-- Specialties -->
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top: 14px;">
        <div class="hwfwm-card__title" style="font-size: 0.95em; color:#000;">Specialties</div>
        <button type="button" class="hwfwm-itembtn" data-action="add-specialty-row">Add Row</button>
      </div>

      {{#each system.adjustments.specialties as |row i|}}
        <div style="display:grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 8px;">
          <div>
            <div class="hwfwm-label" style="color:#000;">Specialty Type</div>
            <select name="system.adjustments.specialties.{{i}}.type">
              <option value="">— Select —</option>
              {{#each @root.specialtyTypeOptions as |o|}}
                <option value="{{o.value}}" {{#if (eq o.value row.type)}}selected{{/if}}>{{o.label}}</option>
              {{/each}}
            </select>
          </div>

          <div>
            <div class="hwfwm-label" style="color:#000;">Specialty</div>
            <select name="system.adjustments.specialties.{{i}}.key">
              <option value="">— Select —</option>
              {{#if row.type}}
                {{#each (lookup @root.specialtiesByType row.type) as |s|}}
                  <option value="{{s.value}}" {{#if (eq s.value row.key)}}selected{{/if}}>{{s.label}}</option>
                {{/each}}
              {{/if}}
            </select>
          </div>

          <div style="display:flex; align-items:flex-end;">
            <button type="button" class="hwfwm-itembtn" data-action="remove-specialty-row" data-index="{{i}}">Remove</button>
          </div>
        </div>
      {{/each}}

      <!-- Affinities -->
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top: 14px;">
        <div class="hwfwm-card__title" style="font-size: 0.95em; color:#000;">Affinities</div>
        <button type="button" class="hwfwm-itembtn" data-action="add-affinity-row">Add Row</button>
      </div>

      {{#each system.adjustments.affinities as |row i|}}
        <div style="display:grid; grid-template-columns: 1fr auto; gap: 10px; margin-bottom: 8px;">
          <div>
            <select name="system.adjustments.affinities.{{i}}.key">
              <option value="">— Select Affinity —</option>
              {{#each @root.affinityOptions as |o|}}
                <option value="{{o.value}}" {{#if (eq o.value row.key)}}selected{{/if}}>{{o.label}}</option>
              {{/each}}
            </select>
          </div>
          <div>
            <button type="button" class="hwfwm-itembtn" data-action="remove-affinity-row" data-index="{{i}}">Remove</button>
          </div>
        </div>
      {{/each}}

      <!-- Resistances -->
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top: 14px;">
        <div class="hwfwm-card__title" style="font-size: 0.95em; color:#000;">Resistances</div>
        <button type="button" class="hwfwm-itembtn" data-action="add-resistance-row">Add Row</button>
      </div>

      {{#each system.adjustments.resistances as |row i|}}
        <div style="display:grid; grid-template-columns: 1fr auto; gap: 10px; margin-bottom: 8px;">
          <div>
            <select name="system.adjustments.resistances.{{i}}.key">
              <option value="">— Select Resistance —</option>
              {{#each @root.resistanceOptions as |o|}}
                <option value="{{o.value}}" {{#if (eq o.value row.key)}}selected{{/if}}>{{o.label}}</option>
              {{/each}}
            </select>
          </div>
          <div>
            <button type="button" class="hwfwm-itembtn" data-action="remove-resistance-row" data-index="{{i}}">Remove</button>
          </div>
        </div>
      {{/each}}

    </div>

    <!-- NOTES -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Notes</div>
      <textarea name="system.notes" rows="6">{{system.notes}}</textarea>
    </div>

  </section>
</div>
