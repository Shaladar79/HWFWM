<div class="hwfwm-item-sheet" autocomplete="off">
  <header class="hwfwm-sheet__header">
    <input
      class="hwfwm-sheet__name"
      name="name"
      type="text"
      value="{{item.name}}"
      placeholder="Talent Name"
    />
  </header>

  <section class="hwfwm-sheet__body" style="padding: 12px; color:#000;">

    <!-- CORE -->
    <div class="hwfwm-card">
      <div class="hwfwm-card__title" style="color:#000;">Core</div>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">

        <div>
          <label class="hwfwm-label" style="color:#000;">Source</label>
          <select name="system.source">
            <option value="trained" {{#if (eq system.source "trained")}}selected{{/if}}>Trained</option>
            <option value="granted" {{#if (eq system.source "granted")}}selected{{/if}}>Granted</option>
          </select>
        </div>

        <div>
          <label class="hwfwm-label" style="color:#000;">Category</label>
          <select name="system.category">
            <option value="attributes" {{#if (eq system.category "attributes")}}selected{{/if}}>Attributes</option>
            <option value="resources" {{#if (eq system.category "resources")}}selected{{/if}}>Resources</option>
            <option value="specialties" {{#if (eq system.category "specialties")}}selected{{/if}}>Specialties</option>
            <option value="affinities" {{#if (eq system.category "affinities")}}selected{{/if}}>Affinities</option>
            <option value="aptitudes" {{#if (eq system.category "aptitudes")}}selected{{/if}}>Aptitudes</option>
            <option value="resistances" {{#if (eq system.category "resistances")}}selected{{/if}}>Resistances</option>
            <option value="expertise" {{#if (eq system.category "expertise")}}selected{{/if}}>Expertise</option>
          </select>
        </div>

        <div style="grid-column: 1 / span 2;">
          <label class="hwfwm-label" style="color:#000;">Tags</label>
          <input type="text" name="system.tags" value="{{system.tags}}" placeholder="comma, separated, tags" />
        </div>
      </div>
    </div>

    <!-- CATEGORY: ATTRIBUTES -->
    {{#if (eq system.category "attributes")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Attribute Adjustments</div>
        <div class="hwfwm-muted" style="margin-bottom: 8px; color:#000;">
          Flat adjustments only. Attributes are never adjusted by %.
        </div>

        <div style="display:grid; grid-template-columns: 1.2fr 1fr; gap: 8px; align-items:center;">
          <div style="color:#000;"><strong>Attribute</strong></div>
          <div style="color:#000;"><strong>Flat Delta</strong></div>

          {{#each attributesList as |a|}}
            <div style="color:#000;">{{a.label}}</div>
            <input
              type="number"
              name="system.adjustments.attributes.{{a.value}}.flat"
              value="{{lookup (lookup ../system.adjustments.attributes a.value) 'flat'}}"
              step="1"
              placeholder="0"
            />
          {{/each}}
        </div>
      </div>
    {{/if}}

    <!-- CATEGORY: RESOURCES -->
    {{#if (eq system.category "resources")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Resource / Status Adjustments</div>
        <div class="hwfwm-muted" style="margin-bottom: 8px; color:#000;">
          Life Force, Mana, and Stamina support Flat + % adjustments. All other entries are Flat only.
        </div>

        <div style="display:grid; grid-template-columns: 1.4fr 1fr 1fr; gap: 8px; align-items:center;">
          <div style="color:#000;"><strong>Resource</strong></div>
          <div style="color:#000;"><strong>% Delta</strong></div>
          <div style="color:#000;"><strong>Flat Delta</strong></div>

          <!-- Life Force -->
          <div style="color:#000;">Life Force (Max)</div>
          <input
            type="number"
            name="system.adjustments.resources.lifeForce.pct"
            value="{{lookup (lookup system.adjustments.resources 'lifeForce') 'pct'}}"
            step="1"
            placeholder="0"
          />
          <input
            type="number"
            name="system.adjustments.resources.lifeForce.flat"
            value="{{lookup (lookup system.adjustments.resources 'lifeForce') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Mana -->
          <div style="color:#000;">Mana (Max)</div>
          <input
            type="number"
            name="system.adjustments.resources.mana.pct"
            value="{{lookup (lookup system.adjustments.resources 'mana') 'pct'}}"
            step="1"
            placeholder="0"
          />
          <input
            type="number"
            name="system.adjustments.resources.mana.flat"
            value="{{lookup (lookup system.adjustments.resources 'mana') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Stamina -->
          <div style="color:#000;">Stamina (Max)</div>
          <input
            type="number"
            name="system.adjustments.resources.stamina.pct"
            value="{{lookup (lookup system.adjustments.resources 'stamina') 'pct'}}"
            step="1"
            placeholder="0"
          />
          <input
            type="number"
            name="system.adjustments.resources.stamina.flat"
            value="{{lookup (lookup system.adjustments.resources 'stamina') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Trauma (flat only) -->
          <div style="color:#000;">Trauma (Max)</div>
          <div></div>
          <input
            type="number"
            name="system.adjustments.resources.trauma.flat"
            value="{{lookup (lookup system.adjustments.resources 'trauma') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Pace (flat only) -->
          <div style="color:#000;">Pace</div>
          <div></div>
          <input
            type="number"
            name="system.adjustments.resources.pace.flat"
            value="{{lookup (lookup system.adjustments.resources 'pace') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Reaction (flat only) -->
          <div style="color:#000;">Reaction</div>
          <div></div>
          <input
            type="number"
            name="system.adjustments.resources.reaction.flat"
            value="{{lookup (lookup system.adjustments.resources 'reaction') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Defense (flat only) -->
          <div style="color:#000;">Defense</div>
          <div></div>
          <input
            type="number"
            name="system.adjustments.resources.defense.flat"
            value="{{lookup (lookup system.adjustments.resources 'defense') 'flat'}}"
            step="1"
            placeholder="0"
          />

          <!-- Natural Armor (flat only) -->
          <div style="color:#000;">Natural Armor</div>
          <div></div>
          <input
            type="number"
            name="system.adjustments.resources.naturalArmor.flat"
            value="{{lookup (lookup system.adjustments.resources 'naturalArmor') 'flat'}}"
            step="1"
            placeholder="0"
          />
        </div>
      </div>
    {{/if}}

    <!-- CATEGORY: SPECIALTIES -->
    {{#if (eq system.category "specialties")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Specialty Grant</div>
        <div class="hwfwm-muted" style="margin-bottom: 8px; color:#000;">
          Choose a specialty type, then choose a specialty from that type.
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div>
            <label class="hwfwm-label" style="color:#000;">Specialty Type</label>
            <select name="system.grants.specialty.type">
              <option value="">— Select Type —</option>
              {{#each specialtyTypeOptions as |o|}}
                <option value="{{o.value}}" {{#if (eq o.value ../system.grants.specialty.type)}}selected{{/if}}>
                  {{o.label}}
                </option>
              {{/each}}
            </select>
          </div>

          <div>
            <label class="hwfwm-label" style="color:#000;">Specialty</label>

            <!-- FIX: use @root to avoid parent-scope lookup failures -->
            <select name="system.grants.specialty.key">
              <option value="">— Select Specialty —</option>

              {{#if @root.system.grants.specialty.type}}
                {{#each (lookup @root.specialtiesByType @root.system.grants.specialty.type) as |s|}}
                  <option value="{{s.value}}" {{#if (eq s.value @root.system.grants.specialty.key)}}selected{{/if}}>
                    {{s.label}}
                  </option>
                {{/each}}
              {{/if}}
            </select>
          </div>
        </div>
      </div>
    {{/if}}

    <!-- CATEGORY: AFFINITIES -->
    {{#if (eq system.category "affinities")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Affinity Grant</div>

        <label class="hwfwm-label" style="color:#000;">Affinity</label>
        <select name="system.grants.affinity.key">
          <option value="">— Select Affinity —</option>
          {{#each affinityOptions as |o|}}
            <option value="{{o.value}}" {{#if (eq o.value ../system.grants.affinity.key)}}selected{{/if}}>
              {{o.label}}
            </option>
          {{/each}}
        </select>
      </div>
    {{/if}}

    <!-- CATEGORY: APTITUDES -->
    {{#if (eq system.category "aptitudes")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Aptitude Grant</div>

        <label class="hwfwm-label" style="color:#000;">Aptitude</label>
        <select name="system.grants.aptitude.key">
          <option value="">— Select Aptitude —</option>
          {{#each aptitudeOptions as |o|}}
            <option value="{{o.value}}" {{#if (eq o.value ../system.grants.aptitude.key)}}selected{{/if}}>
              {{o.label}}
            </option>
          {{/each}}
        </select>
      </div>
    {{/if}}

    <!-- CATEGORY: RESISTANCES -->
    {{#if (eq system.category "resistances")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Resistance Grant</div>

        <label class="hwfwm-label" style="color:#000;">Resistance</label>
        <select name="system.grants.resistance.key">
          <option value="">— Select Resistance —</option>
          {{#each resistanceOptions as |o|}}
            <option value="{{o.value}}" {{#if (eq o.value ../system.grants.resistance.key)}}selected{{/if}}>
              {{o.label}}
            </option>
          {{/each}}
        </select>
      </div>
    {{/if}}

    <!-- CATEGORY: EXPERTISE (placeholder) -->
    {{#if (eq system.category "expertise")}}
      <div class="hwfwm-card" style="margin-top: 12px;">
        <div class="hwfwm-card__title" style="color:#000;">Expertise</div>
        <div class="hwfwm-muted" style="color:#000;">
          Expertise UI not wired yet.
        </div>
      </div>
    {{/if}}

    <!-- DESCRIPTION (always visible) -->
    <div class="hwfwm-card" style="margin-top: 12px;">
      <div class="hwfwm-card__title" style="color:#000;">Description</div>

      {{editor
        system.description
        target="system.description"
        button=true
        owner=owner
        editable=editable
      }}
    </div>

  </section>
</div>
